---
title: "Day 12: Helm åŸºç¤"
tags: 2025éµäººè³½
date: 2025-07-20
---

Day 12 Helm åŸºç¤
ğŸ¯ å­¸ç¿’ç›®æ¨™
å®Œæˆæœ¬æ—¥å­¸ç¿’å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š

 ç†è§£ä»€éº¼æ˜¯ Helm ä»¥åŠç‚ºä»€éº¼éœ€è¦å®ƒ
 æŒæ¡ Helm çš„æ ¸å¿ƒæ¦‚å¿µå’Œæ¶æ§‹
 æˆåŠŸå®‰è£å’Œé…ç½® Helm
 åŸ·è¡ŒåŸºæœ¬çš„ Helm å‘½ä»¤æ“ä½œ
 å®Œæˆç¬¬ä¸€å€‹æ‡‰ç”¨çš„å®‰è£å’Œç®¡ç†
 
ğŸ“– ç†è«–åŸºç¤
ä»€éº¼æ˜¯ Helmï¼Ÿ
æƒ³åƒä½ è¦æ­å»ºä¸€å€‹è¤‡é›œçš„æ¨‚é«˜åŸå ¡ï¼Œå¦‚æœæ¯æ¬¡éƒ½è¦ä¸€å¡Šä¸€å¡Šåœ°çµ„è£ï¼Œæœƒéå¸¸éº»ç…©ã€‚Helm å°±åƒæ˜¯æ¨‚é«˜çš„ã€Œé è£½å¥—ä»¶ã€ï¼Œè®“ä½ å¯ä»¥å¿«é€Ÿéƒ¨ç½²æ•´å¥— Kubernetes æ‡‰ç”¨ã€‚

```mermaid
graph TB
    A[å‚³çµ± K8s éƒ¨ç½²] --> B[éœ€è¦å¤šå€‹ YAML æª”æ¡ˆ]
    B --> C[æ‰‹å‹•ç®¡ç†ä¾è³´é—œä¿‚]
    C --> D[é›£ä»¥ç‰ˆæœ¬æ§åˆ¶]
    D --> E[éƒ¨ç½²è¤‡é›œä¸”å®¹æ˜“å‡ºéŒ¯]
    
    F[ä½¿ç”¨ Helm] --> G[å–®ä¸€ Chart åŒ…å«æ‰€æœ‰è³‡æº]
    G --> H[è‡ªå‹•è™•ç†ä¾è³´]
    H --> I[ç‰ˆæœ¬åŒ–ç®¡ç†]
    I --> J[ä¸€éµéƒ¨ç½²å’Œå‡ç´š]
    
    style F fill:#e1f5fe
    style J fill:#c8e6c9

```

Helm æ ¸å¿ƒæ¦‚å¿µ
```mermaid
graph LR
    A[Chart] --> B[Release]
    C[Repository] --> A
    D[Values] --> B
    
    A1[Chart<br/>ğŸ“¦ æ‡‰ç”¨ç¨‹å¼åŒ…] --> A2[åŒ…å«:<br/>â€¢ templates/<br/>â€¢ values.yaml<br/>â€¢ Chart.yaml]
    
    B1[Release<br/>ğŸš€ é‹è¡Œå¯¦ä¾‹] --> B2[Chart çš„<br/>å®‰è£ç‰ˆæœ¬<br/>å¯ä»¥å¤šå€‹]
    
    C1[Repository<br/>ğŸª Chart å€‰åº«] --> C2[å­˜æ”¾å’Œåˆ†äº«<br/>Chart çš„åœ°æ–¹<br/>é¡ä¼¼ npm registry]
    
    D1[Values<br/>âš™ï¸ é…ç½®åƒæ•¸] --> D2[è‡ªè¨‚ Chart<br/>çš„é…ç½®é¸é …<br/>è¦†è“‹é è¨­å€¼]
    
    style A1 fill:#ffecb3
    style B1 fill:#e8f5e8
    style C1 fill:#e3f2fd
    style D1 fill:#fce4ec
```

Helm æ¶æ§‹åœ–
```mermaid
graph TB
  subgraph "é–‹ç™¼ç’°å¢ƒ"
      DEV[ğŸ‘¨â€ğŸ’» é–‹ç™¼è€…]
      CLI[âš¡ Helm CLI]
      CHART[ğŸ“¦ Chart é–‹ç™¼]
      VALUES[âš™ï¸ Values é…ç½®]
  end
  
  subgraph "Chart å€‰åº«"
      HUB[ğŸŒ Helm Hub]
      CUSTOM[ğŸ  è‡ªè¨‚å€‰åº«]
      OFFICIAL[âœ… å®˜æ–¹ Charts]
      BITNAMI[ğŸ”· Bitnami Charts]
  end
  
  subgraph "Kubernetes é›†ç¾¤"
      subgraph "Helm ç‰ˆæœ¬å·®ç•°"
          HELM2[âš ï¸ Helm 2.x + Tiller]
          HELM3[âœ¨ Helm 3.x ç›´æ¥æ“ä½œ]
      end
      
      API[ğŸ¯ Kubernetes API]
      
      subgraph "æ‡‰ç”¨è³‡æº"
          DEPLOY[ğŸš€ Deployments]
          SVC[ğŸŒ Services]
          CONFIG[ğŸ“‹ ConfigMaps]
          SECRET[ğŸ” Secrets]
      end
  end
  
  DEV --> CLI
  CLI --> CHART
  CLI --> VALUES
  
  CLI -->|helm repo add| HUB
  CLI -->|helm repo add| CUSTOM
  CLI -->|helm repo add| OFFICIAL
  CLI -->|helm repo add| BITNAMI
  
  CLI -->|helm install| HELM3
  CLI -.->|èˆŠç‰ˆæœ¬| HELM2
  
  HELM3 --> API
  HELM2 -.-> API
  
  API --> DEPLOY
  API --> SVC
  API --> CONFIG
  API --> SECRET
  
  style CLI fill:#1976d2,color:#fff
  style HELM3 fill:#4caf50,color:#fff
  style HELM2 fill:#f44336,color:#fff
  style API fill:#ff9800,color:#fff
  style DEV fill:#9c27b0,color:#fff
```


ğŸ› ï¸ å¯¦ä½œç’°ç¯€
Lab 1: Helm å®‰è£èˆ‡é©—è­‰
æ­¥é©Ÿ 1: å®‰è£ Helm
Linux ç”¨æˆ¶ï¼š

```bash
# ä¸‹è¼‰ä¸¦å®‰è£æœ€æ–°ç‰ˆæœ¬
> curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3
> chmod 700 get_helm.sh
> ./get_helm.sh

# é©—è­‰å®‰è£
> helm version
helm version
version.BuildInfo{Version:"v3.18.5", GitCommit:"b78692c18f0fb38fe5ba4571a674de067a4c53a5", GitTreeState:"clean", GoVersion:"go1.24.5"}
```

æ­¥é©Ÿ 2: æª¢æŸ¥ Kubernetes é€£æ¥
```bash
# ç¢ºä¿å¯ä»¥é€£æ¥åˆ° K8s é›†ç¾¤
kubectl cluster-info

# æª¢æŸ¥ç•¶å‰ context
kubectl config current-context

# å¦‚æœä½¿ç”¨ KinDï¼Œç¢ºä¿ Cluster æ­£åœ¨é‹è¡Œ
kind get clusters
```

Lab 2: ç¬¬ä¸€å€‹ Helm å‘½ä»¤
æ­¥é©Ÿ 1: æ·»åŠ å®˜æ–¹ Repository [Binami](https://github.com/bitnami/charts/tree/main/bitnami)
```bash=
# æ·»åŠ  Bitnami repositoryï¼ˆåŒ…å«å¾ˆå¤šå¸¸ç”¨æ‡‰ç”¨ï¼‰
helm repo add bitnami https://charts.bitnami.com/bitnami

# æ›´æ–° repository è³‡è¨Š
helm repo update

# æŸ¥çœ‹å·²æ·»åŠ çš„ repositories
> helm repo list
# é æœŸè¼¸å‡º
NAME          	URL                                    
bitnami       	https://charts.bitnami.com/bitnami     
```
æ­¥é©Ÿ 2: æœå°‹å¯ç”¨çš„ Charts
```bash=
# æœå°‹ nginx ç›¸é—œçš„ charts
helm search repo nginx

# æœå°‹æ‰€æœ‰ bitnami çš„ charts
helm search repo bitnami/
```

Lab 3: å®‰è£ç¬¬ä¸€å€‹æ‡‰ç”¨
æ­¥é©Ÿ 1: æŸ¥çœ‹ Chart è³‡è¨Š
```bash
# æŸ¥çœ‹ nginx chart çš„åŸºæœ¬è³‡è¨Š
> helm show chart bitnami/nginx

# åŸºæœ¬è³‡è¨Šå€å¡Š
NAME: demo-nginx                    # Release åç¨±
LAST DEPLOYED: Sun Aug 17 00:45:55 2025  # æœ€å¾Œéƒ¨ç½²æ™‚é–“
NAMESPACE: default                  # éƒ¨ç½²çš„å‘½åç©ºé–“
STATUS: deployed                    # ç•¶å‰ç‹€æ…‹ï¼ˆå·²éƒ¨ç½²ï¼‰
REVISION: 1                         # ç‰ˆæœ¬è™Ÿï¼ˆç¬¬ä¸€æ¬¡å®‰è£ï¼‰
TEST SUITE: None                    # æ¸¬è©¦å¥—ä»¶ï¼ˆç„¡ï¼‰

# Chart è³‡è¨Šå€å¡Š
CHART NAME: nginx                   # Chart åç¨±
CHART VERSION: 21.1.22             # Chart ç‰ˆæœ¬
APP VERSION: 1.29.1                # æ‡‰ç”¨ç¨‹å¼ç‰ˆæœ¬ï¼ˆNginx 1.29.1ï¼‰
```

```bash
# æŸ¥çœ‹é è¨­çš„ valuesï¼ˆé…ç½®é¸é …ï¼‰
> helm show values bitnami/nginx

é€™å€‹ values æ–‡ä»¶å°±åƒæ˜¯æ‡‰ç”¨ç¨‹å¼çš„ã€Œè¨­å®šæª”ã€ï¼Œä½ å¯ä»¥é€éä¿®æ”¹é€™äº›åƒæ•¸ä¾†ï¼š
- è‡ªè¨‚æ‡‰ç”¨è¡Œç‚º
- èª¿æ•´è³‡æºé…ç½®
- è¨­å®šç¶²è·¯å­˜å–
- é…ç½®å®‰å…¨æ€§
```

æ­¥é©Ÿ 2: å®‰è£ Nginx
```bash=
# å®‰è£ nginxï¼Œrelease åç¨±ç‚º demo-nginx
> helm install demo-nginx bitnami/nginx

# æŸ¥çœ‹å®‰è£ç‹€æ…‹
> helm status demo-nginx
helm status demo-nginx
NAME: demo-nginx
LAST DEPLOYED: Sun Aug 17 00:45:55 2025
NAMESPACE: default
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
CHART NAME: nginx
CHART VERSION: 21.1.22
APP VERSION: 1.29.1

# æŸ¥çœ‹æ‰€æœ‰ releases
> helm list
NAME      	NAMESPACE	REVISION	UPDATED                               	STATUS  CHART        	APP VERSION
demo-nginx	default  	1       	2025-08-17 00:45:55.67752989 +0800 CST	deployednginx-21.1.22	1.29.1     
```

æ­¥é©Ÿ 3: é©—è­‰éƒ¨ç½²
```bash=
# æŸ¥çœ‹å‰µå»ºçš„ Kubernetes è³‡æº
> kubectl get pods
> kubectl get services
> kubectl get deployments

# æŸ¥çœ‹ nginx pod çš„è©³ç´°è³‡è¨Š
> kubectl describe pod -l app.kubernetes.io/name=nginx
```

æ­¥é©Ÿ 4: è¨ªå•æ‡‰ç”¨
```bash=
# ä½¿ç”¨ port-forward è¨ªå• nginx
kubectl port-forward svc/my-nginx 8080:80

# åœ¨å¦ä¸€å€‹çµ‚ç«¯æ¸¬è©¦
curl http://localhost:8080
```

æ­¥é©Ÿ 5: å¸è¼‰ Release

```bash=
# å¸è¼‰ nginx
helm uninstall my-nginx

# é©—è­‰å¸è¼‰
helm list
kubectl get pods
```

Helm  å·¥ä½œæµç¨‹åœ–
```mermaid
flowchart TD
    A[é–‹å§‹] --> B[æ·»åŠ  Repository]
    B --> C[æœå°‹ Chart]
    C --> D[æŸ¥çœ‹ Chart è³‡è¨Š]
    D --> E[å®‰è£ Release]
    E --> F[é©—è­‰éƒ¨ç½²]
    F --> G{éœ€è¦ä¿®æ”¹?}
    G -->|æ˜¯| H[å‡ç´š Release]
    G -->|å¦| I[ä½¿ç”¨æ‡‰ç”¨]
    H --> F
    I --> J{ä¸å†éœ€è¦?}
    J -->|æ˜¯| K[å¸è¼‰ Release]
    J -->|å¦| I
    K --> L[çµæŸ]
    
    style A fill:#4caf50,color:#fff
    style L fill:#f44336,color:#fff
    style E fill:#2196f3,color:#fff
    style H fill:#ff9800,color:#fff
```
